sap.ui.define([
	"sap/ui/core/mvc/Controller",
	"sap/m/MessageBox",
	"sap/m/MessageToast",
	"jquery.sap.global"
], function(Controller, MessageBox, MessageToast,jQuery) {
	"use strict";
	return Controller.extend("ZODD_HOURS_S2D.controller.View1", {
		/**
		 *@memberOf ODD_HOURS.controller.View1
		 */
		onClick: function() {
			//This code was generated by the layout editor.
			var id = this.getView().byId("__input0").getValue().toString();
			var name = this.getView().byId("__input1").getValue();
			var email = this.getView().byId("__input2").getValue().toUpperCase();
			var aemail = this.getView().byId("__input6").getValue().toUpperCase();
			var date = this.getView().byId("__input3").getValue().split("-").join("/");
			var hours = this.getView().byId("__input9").getValue();
			var project = this.getView().byId("__input5").getValue();
			var portfolio = this.getView().byId("__inpp").getValue();
			var offering = this.getView().byId("__inpo").getValue();
			var wbs1 = this.getView().byId("__input4").getValue();
			var wbs2 = this.getView().byId("input5").getValue();
			var wbs3 = this.getView().byId("input6").getValue();
			var wbs4 = this.getView().byId("input7").getValue();
			var wbs5 = this.getView().byId("input8").getValue();
			var wbs = wbs1 + "-" + wbs2 + "-" + wbs3 + "-" + wbs4 + "-" + wbs5;
			var oMod = this.getOwnerComponent().getModel("Model");
			var y = date.substr(0 , 4);
			var m = date.substr(5, 2);
			var d = date.substr(8, 2);
			date = "";
			date = y + m + d;
			var ese = "/ODD_DETAILSSet";
			var oentry = {};
			var that = this;
			oentry.EMP_ID = id;
			oentry.DATE = date;
			oentry.EMP_NAME = name;
			oentry.EMP_EMAIL_ID = email;
			oentry.HOURS = hours;
			oentry.WBS_CODE = wbs;
			oentry.PROJECT = project;
			oentry.PORTFOLIO = portfolio;
			oentry.OFFERING = offering;
			oentry.APP_EMAIL_ID = aemail;
			if (id.length === 0 || id.length < 6 || id.match(/[a-z]/i)) {
				MessageBox.error("Invalid Personnel Number");
			} else if (name.length === 0) {
				MessageBox.error("Employee Name is mandatory");
			} else if (email.length === 0 || email.toString().search("@DELOITTE.COM") === -1) {
				MessageBox.error("Employee Email ID is invalid");
			} else if (aemail.length === 0 || aemail.toString().search("@DELOITTE.COM") === -1) {
				MessageBox.error("Approver Email ID is invalid");
			} else if (aemail === email) {
				MessageBox.error("Employee and Approver Email ID cannot be same");
			} else if (date.length === 0) {
				MessageBox.error("Date is mandatory");
			} else if (hours.length === 0 || hours.match(/[a-z]/i) || hours > 24 || hours <= 0) {
				MessageBox.error("Invalid Hours");
			} else if (wbs1.length === 0 || wbs1.length !== 8) {
				MessageBox.error("Invalid WBS Code");
			} else if (wbs2.length === 0 || wbs2.match(/[a-z]/i) || wbs2.length !== 2) {
				MessageBox.error("Invalid WBS Code");
			} else if (wbs3.length === 0 || wbs3.match(/[a-z]/i) || wbs3.length !== 2) {
				MessageBox.error("Invalid WBS Code");
			} else if (wbs4.length === 0 || wbs4.match(/[a-z]/i) || wbs4.length !== 2) {
				MessageBox.error("Invalid WBS Code");
			} else if (wbs5.length === 0 || wbs5.match(/[a-z]/i) || wbs5.length !== 4) {
				MessageBox.error("Invalid WBS Code");
			} else {
				sap.ui.core.BusyIndicator.show();
				oMod.create(ese, oentry, {
					async: false,
					success: function(oData, response) {
						sap.ui.core.BusyIndicator.hide();
						MessageToast.show("Data Saved");
						that.readData();
					},
					error: function(err) {
						sap.ui.core.BusyIndicator.hide();
						sap.m.MessageBox.show(JSON.parse(err.responseText).error.message.value);
					}
				});
			}
		},
		onInit: function() {
			
			this.readData();

			var that = this;
			var oTemp = this.getOwnerComponent().getModel("Name");
			var mPar = {
				async: true,
				success: function(odata) {
					var dat = odata.results;
					that.getView().byId("__input1").setValue(dat[0].NAME);
					if (dat[0].BNAME === "SWASI" || dat[0].BNAME === "VKOLISETTY" || dat[0].BNAME === "MSONIWALA" ) {
						that.getView().byId("__button2").setEnabled(true);
					}
				}
			};
			var set = "/UsernameSet";
			oTemp.read(set, mPar);
		},
		readData: function() {
			var that = this;
			var oModel = this.getOwnerComponent().getModel("Model");
			//Converting odata model to JSON Model
			var mParams = {
				success: function(odata) {
					var data = odata.results;
					var jm = new sap.ui.model.json.JSONModel();
					jm.setData(data);
					that.getView().setModel(jm);
				}
			};
			var eset = "/ODD_DETAILSSet";
			oModel.read(eset, mParams);
		},
		/**
		 *@memberOf ODD_HOURS.controller.View1
		 */
		onClickReport: function(oevt) {
			//This code was generated by the layout editor.
			var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
			oRouter.navTo("View2");
		},
		/**
		 *@memberOf ODD_HOURS.controller.View1
		 */
		onHelp: function() {
			//This code was generated by the layout editor.
		},
		/**
		 *@memberOf ODD_HOURS.controller.View1
		 */
		onApprove: function(oevt) {
			//This code was generated by the layout editor.
			var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
			oRouter.navTo("View3");
		}
	});
});